def _sanitize_for_influx(df: pd.DataFrame) -> pd.DataFrame:
    df = df.copy()

    # 1) 把 pandas 的 pd.NA/NaN 全部換成 None（Influx 不吃 pd.NA）
    df = df.where(pd.notna(df), None)

    # 2) tag 欄位用 object，保留 None（不要變字串 'None'）
    for c in TAG_COLS:
        if c in df.columns:
            df[c] = df[c].astype(object)

    # 3) 可空布林 dtype -> object，避免 "boolean value of NA is ambiguous"
    for c in df.select_dtypes(include="boolean").columns:
        df[c] = df[c].astype(object)

    return df